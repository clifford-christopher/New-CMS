{"openapi":"3.1.0","info":{"title":"AI-Powered News CMS API","description":"Backend API for managing news generation configurations, triggers, and LLM integrations","version":"1.0.0"},"paths":{"/":{"get":{"tags":["Root"],"summary":"Root","description":"Root endpoint - API status check.\n\nReturns:\n    JSON response with API status and version","operationId":"root__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/health":{"get":{"tags":["health"],"summary":"Health Check","description":"Health check endpoint to verify MongoDB connection status.\nReturns status, database connection state, collection counts, and timestamp.\n\nReturns:\n    dict: Health status with database connection info and collection counts","operationId":"health_check_api_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/triggers/":{"get":{"tags":["triggers"],"summary":"Get Triggers","description":"Get all trigger configurations from MongoDB trigger_prompts collection.\n\nReturns list of triggers with:\n- trigger_name: Trigger identifier\n- isActive: Whether News CMS Workflow is enabled\n- llm_config, data_config, prompts: Configuration details (if set)\n- version, timestamps: Metadata\n\nReturns:\n    List[dict]: List of trigger configurations\n\nRaises:\n    HTTPException: 503 if database not connected, 500 on other errors","operationId":"get_triggers_api_triggers__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/triggers/{trigger_name}":{"get":{"tags":["triggers"],"summary":"Get Trigger Detail","description":"Get detailed configuration for a specific trigger.\n\nArgs:\n    trigger_name: Trigger identifier (e.g., \"earnings_result\")\n\nReturns:\n    dict: Full trigger configuration (raw document or parsed)\n\nRaises:\n    HTTPException: 404 if not found, 503 if database not connected, 500 on other errors","operationId":"get_trigger_detail_api_triggers__trigger_name__get","parameters":[{"name":"trigger_name","in":"path","required":true,"schema":{"type":"string","title":"Trigger Name"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/triggers/{trigger_name}/config":{"get":{"tags":["triggers"],"summary":"Get Trigger Config","description":"Get trigger configuration including data API configuration.\n\n**Prompt Loading Strategy:**\n1. Check trigger_prompt_drafts for latest draft (SINGLE document with all prompt types)\n2. If no drafts exist, fallback to prompts in trigger_prompts (published versions)\n3. This allows users to see their latest changes even if not yet published\n\nArgs:\n    trigger_name: Trigger identifier\n\nReturns:\n    dict: Trigger configuration with data_config.apis list and prompts (drafts or published)\n\nRaises:\n    HTTPException: 404 if not found, 503 if database not connected, 500 on other errors","operationId":"get_trigger_config_api_triggers__trigger_name__config_get","parameters":[{"name":"trigger_name","in":"path","required":true,"schema":{"type":"string","title":"Trigger Name"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/triggers/{trigger_name}/config/apis":{"post":{"tags":["triggers"],"summary":"Add Api To Trigger","description":"Add a data API to trigger's configuration.\n\nArgs:\n    trigger_name: Trigger identifier\n    api_data: API configuration (e.g., {\"api_id\": \"earnings_api\", \"name\": \"Earnings API\"})\n\nReturns:\n    dict: Updated APIs list\n\nRaises:\n    HTTPException: 400 if duplicate, 404 if trigger not found, 503 if database not connected","operationId":"add_api_to_trigger_api_triggers__trigger_name__config_apis_post","parameters":[{"name":"trigger_name","in":"path","required":true,"schema":{"type":"string","title":"Trigger Name"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","additionalProperties":true,"title":"Api Data"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/triggers/{trigger_name}/config/apis/{api_id}":{"delete":{"tags":["triggers"],"summary":"Remove Api From Trigger","description":"Remove a data API from trigger's configuration.\n\nArgs:\n    trigger_name: Trigger identifier\n    api_id: API identifier to remove\n\nReturns:\n    dict: Updated APIs list\n\nRaises:\n    HTTPException: 400 if required API, 404 if not found, 503 if database not connected","operationId":"remove_api_from_trigger_api_triggers__trigger_name__config_apis__api_id__delete","parameters":[{"name":"trigger_name","in":"path","required":true,"schema":{"type":"string","title":"Trigger Name"}},{"name":"api_id","in":"path","required":true,"schema":{"type":"string","title":"Api Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/triggers/available-apis":{"get":{"tags":["triggers"],"summary":"Get Available Apis","description":"Get list of all available data APIs that can be configured.\n\nReturns:\n    List[dict]: List of available API configurations","operationId":"get_available_apis_api_triggers_available_apis_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/triggers/{trigger_name}/config/prompts":{"post":{"tags":["triggers"],"summary":"Save Prompt Drafts","description":"Save prompt drafts to trigger_prompt_drafts collection (does NOT modify trigger_prompts).\n\nCreates a SINGLE document containing all prompt types (paid, unpaid, crawler) for this trigger.\nEach save creates a new version, preserving full history.\n\nArgs:\n    trigger_name: Trigger identifier\n    prompts_data: Prompts object with paid, unpaid, crawler templates\n                 Example: {\"prompts\": {\"paid\": {\"template\": \"...\"}, \"unpaid\": {\"template\": \"...\"}, \"crawler\": {\"template\": \"...\"}}}\n\nReturns:\n    PromptDraftResponse: Success status and created draft document\n\nRaises:\n    HTTPException: 400 if invalid prompt type, 404 if trigger not found, 503 if database not connected","operationId":"save_prompt_drafts_api_triggers__trigger_name__config_prompts_post","parameters":[{"name":"trigger_name","in":"path","required":true,"schema":{"type":"string","title":"Trigger Name"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","additionalProperties":true,"title":"Prompts Data"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PromptDraftResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/triggers/{trigger_name}/config/prompts/versions":{"get":{"tags":["triggers"],"summary":"Get Prompt Versions","description":"Get list of all saved prompt versions for a trigger.\n\nReturns version metadata including version number, timestamp, and author\nfor all saved drafts of the specified trigger.\n\nArgs:\n    trigger_name: Trigger identifier\n\nReturns:\n    dict: Contains 'versions' array and 'total' count\n\nRaises:\n    HTTPException: 503 if database not connected, 500 on other errors","operationId":"get_prompt_versions_api_triggers__trigger_name__config_prompts_versions_get","parameters":[{"name":"trigger_name","in":"path","required":true,"schema":{"type":"string","title":"Trigger Name"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/triggers/{trigger_name}/config/prompts/version/{version_number}":{"get":{"tags":["triggers"],"summary":"Get Prompt Version","description":"Get specific version of prompts for preview.\n\nRetrieves the complete prompt data for a specific version number,\nallowing users to preview or restore historical versions.\n\nArgs:\n    trigger_name: Trigger identifier\n    version_number: Version number to retrieve\n\nReturns:\n    dict: Complete prompt data for the specified version including all prompt types\n\nRaises:\n    HTTPException: 404 if version not found, 503 if database not connected, 500 on other errors","operationId":"get_prompt_version_api_triggers__trigger_name__config_prompts_version__version_number__get","parameters":[{"name":"trigger_name","in":"path","required":true,"schema":{"type":"string","title":"Trigger Name"}},{"name":"version_number","in":"path","required":true,"schema":{"type":"integer","title":"Version Number"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/stocks/{stock_id}/trigger-data":{"get":{"tags":["stocks"],"summary":"Get Stock Trigger Data","description":"Get OLD news trigger data for a specific stock from news_triggers collection.\n\nThis endpoint searches by exact numeric stockid and optionally filters by trigger_name.\nReturns the most recent document sorted by 'date' field (descending).\nReturns ONLY the 'data' node content (OLD data), not the entire document.\n\nArgs:\n    stock_id: Numeric stock ID (e.g., \"399834\", \"513374\")\n    trigger_name: Optional trigger name filter (e.g., \"52wk_high\")\n\nReturns:\n    Data content from the 'data' node in news_triggers collection (OLD data)\n\nRaises:\n    HTTPException: 400 if stock_id is not numeric, 404 if not found, 503 if database not connected, 500 on other errors","operationId":"get_stock_trigger_data_api_stocks__stock_id__trigger_data_get","parameters":[{"name":"stock_id","in":"path","required":true,"schema":{"type":"string","title":"Stock Id"}},{"name":"trigger_name","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filter by specific trigger name","title":"Trigger Name"},"description":"Filter by specific trigger name"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/data/structured/generate":{"post":{"tags":["data"],"summary":"Generate Structured Data","description":"Create a new job to generate structured data sections\n\nThis endpoint creates an async job and returns immediately with a job_id.\nUse GET /api/data/structured/jobs/{job_id} to poll the job status.\n\nArgs:\n    request: GenerateRequest containing stock_id and sections list\n\nReturns:\n    JobResponse with job_id and status \"pending\"\n\nRaises:\n    HTTPException: 400 for invalid input, 503 if database not connected, 500 on other errors","operationId":"generate_structured_data_api_data_structured_generate_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/GenerateRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/JobResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/data/structured/jobs/{job_id}":{"get":{"tags":["data"],"summary":"Get Job Status","description":"Get the status of a structured data generation job\n\nPoll this endpoint to check job progress and retrieve results when completed.\n\nArgs:\n    job_id: MongoDB ObjectId as string\n\nReturns:\n    JobStatusResponse with current job status and data (if completed)\n\nRaises:\n    HTTPException: 400 for invalid job_id, 404 if job not found, 503 if database not connected, 500 on other errors","operationId":"get_job_status_api_data_structured_jobs__job_id__get","parameters":[{"name":"job_id","in":"path","required":true,"schema":{"type":"string","title":"Job Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/JobStatusResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}}},"components":{"schemas":{"GenerateRequest":{"properties":{"stock_id":{"type":"string","title":"Stock Id","description":"Numeric stock ID (e.g., '399834')"},"sections":{"items":{"type":"string"},"type":"array","title":"Sections","description":"List of section IDs to generate (1-14)"}},"type":"object","required":["stock_id","sections"],"title":"GenerateRequest","description":"Request model for generating structured data","example":{"sections":["1","2","3"],"stock_id":"399834"}},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"JobResponse":{"properties":{"job_id":{"type":"string","title":"Job Id","description":"Unique job identifier"},"status":{"type":"string","title":"Status","description":"Job status: pending"},"message":{"type":"string","title":"Message","description":"Human-readable message"}},"type":"object","required":["job_id","status","message"],"title":"JobResponse","description":"Response model when creating a new generation job","example":{"job_id":"507f1f77bcf86cd799439011","message":"Job created successfully","status":"pending"}},"JobStatusResponse":{"properties":{"job_id":{"type":"string","title":"Job Id","description":"Unique job identifier"},"status":{"type":"string","title":"Status","description":"Job status: pending, running, completed, failed"},"stock_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Stock Id","description":"Stock ID from request"},"requested_sections":{"anyOf":[{"items":{"type":"string"},"type":"array"},{"type":"null"}],"title":"Requested Sections","description":"Requested section IDs"},"sections_data":{"anyOf":[{"items":{"$ref":"#/components/schemas/SectionData"},"type":"array"},{"type":"null"}],"title":"Sections Data","description":"Generated section data (only when completed)"},"error":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Error","description":"Error message (only when failed)"},"created_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Created At","description":"Job creation timestamp"},"completed_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Completed At","description":"Job completion timestamp"}},"type":"object","required":["job_id","status"],"title":"JobStatusResponse","description":"Response model for job status polling","example":{"completed_at":"2025-10-31T10:30:12","created_at":"2025-10-31T10:30:00","job_id":"507f1f77bcf86cd799439011","requested_sections":["1","2","3"],"sections_data":[{"content":"...","section_id":"1","section_name":"Company Information"}],"status":"completed","stock_id":"399834"}},"PromptDraftResponse":{"properties":{"success":{"type":"boolean","title":"Success"},"message":{"type":"string","title":"Message"},"draft":{"additionalProperties":true,"type":"object","title":"Draft"},"trigger_name":{"type":"string","title":"Trigger Name"},"version":{"type":"integer","title":"Version"}},"type":"object","required":["success","message","draft","trigger_name","version"],"title":"PromptDraftResponse","description":"Response model after saving prompt drafts"},"SectionData":{"properties":{"section_id":{"type":"string","title":"Section Id","description":"Section identifier (1-14)"},"section_name":{"type":"string","title":"Section Name","description":"Human-readable section name"},"content":{"type":"string","title":"Content","description":"Section content/data"}},"type":"object","required":["section_id","section_name","content"],"title":"SectionData","description":"Model for individual section data"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}}}}